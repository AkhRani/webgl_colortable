<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Web GL Color Lookup</title>
        <script src="coloradjuster.js"></script>
        <script>
          adjuster = new ColorAdjuster();

          function start() {
            var canvas = document.getElementById("glcanvas");
            adjuster.init(canvas);

            readWindowControls();
            onGradientButton(null);

            document.getElementById("windowControl").
              addEventListener("input", onWindowChanged, false);
            document.getElementById("levelControl").
              addEventListener("input", onWindowChanged, false);
            document.getElementById("gradientButton").
              addEventListener("click", onGradientButton, false);
            document.getElementById("NPOTEvenButton").
              addEventListener("click", onNpotEvenButton, false);
            document.getElementById("NPOTOddButton").
              addEventListener("click", onNpotOddButton, false);
            document.getElementById("invertCheckbox").
              addEventListener("change", onWindowChanged, false);
          }

          function readWindowControls() {
            var windowControl = document.getElementById("windowControl");
            var levelControl =  document.getElementById("levelControl");

            // Rescale window width from 256 to 4096
            var width = windowControl.value * 16;

            // Determine the highest and lowest possible center values
            var lowestCenter = width / 2;
            var highestCenter = 4096 - (width / 2);
            var centerRange = (highestCenter - lowestCenter);
            var relativeCenter = levelControl.value / 256.0;
            var center = relativeCenter * centerRange + lowestCenter;

            adjuster.setWindowWidthAndCenter(width, center);
          }

          function redrawImage() {
            var invertControl = document.getElementById("invertCheckbox");
            adjuster.drawImage(invertControl.checked);
          }

          function onWindowChanged(evt) {
            readWindowControls();
            redrawImage();
          }

          function onGradientButton(evt) {
            var data = new Uint16Array(256*256);
            for (i = 0; i < 256*256; i++) {
              data[i] = i & 0xFFF;
            }
            adjuster.setImageData(data, 256, 256);
            redrawImage();
          }

          function onNpotEvenButton(evt) {
            onNpot(14);
          }

          function onNpotOddButton(evt) {
            onNpot(13);
          }

          function onNpot(size) {
            var data = new Uint16Array(size * size);
            for (i = 0; i < size * size; i++) {
              data[i] = 0;
            }
            data[0] = 2048;
            data[size - 1] = 2048;
            data[size * (size-1)] = 2048;
            data[size * size - 1] = 2048;

            adjuster.setImageData(data, size, size);
            adjuster.drawImage();
          }

        </script>
    </head>

    <body onload="start()">
      <canvas id="glcanvas" width="256" height="256">
      Missing canvas support
      </canvas>
      </br>
      <input id="windowControl" type="range" min="3" max="256" value="256" >Window</input></br>
      <input id="levelControl" type="range" min="0" max="255" value="128" >Level</input></br>
      <input id="gradientButton" type="button" value="Gradient"></input></br>
      <input id="NPOTEvenButton" type="button" value="NPOT Even"></input></br>
      <input id="NPOTOddButton" type="button" value="NPOT Odd"></input></br>
      <input id="invertCheckbox" type="checkbox" value="inverted">Invert</input></br>
    </body>

</html>

